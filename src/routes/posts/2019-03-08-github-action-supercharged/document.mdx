import styles from './document.module.css'

<div className={styles.warning}>
  ðŸ˜¢ unfortunately GitHub actions is still in Limited public,
    sign up <a href="https://github.com/features/actions">here</a>
</div>


## Examples

Let's start with code and see GitHub actions in action. ðŸ˜„

### Mobile app with firebase

```css
workflow "Test on every push" {
  on = "push"
  resolves = ["TypeCheck", "Lints", "Unit Tests", "E2E Tests"]
}

action "Yarn Install" {
  uses = "docker://node:10"
  runs = "yarn"
  args = "install"
}

action "TypeCheck" {
  needs = ["Yarn install"]
  uses = "docker://node:10"
  runs = "yarn"
  args = "tsc"
}

action "Lints" {
  needs = ["Yarn install"]
  uses = "docker://node:10"
  runs = "yarn"
  args = "tslint"
}

action "Unit Tests" {
  needs = ["Yarn install"]
  uses = "docker://node:10"
  runs = "yarn"
  args = "test"
}

action "E2E Tests" {
  needs = ["Yarn install"]
  uses = "docker://node:10"
  runs = "yarn"
  args = "e2e"
}
```

This will run the tests on every push, including ones in an PR. And if something went wrong, these checks will fail on that PR.

When when PR is merged

```css
workflow "Automatically deploy to staging" {
  on = "push"
  resolves = ["Deploy Staging"]
}

action "Is backend files changed" {
  uses = "zhigang1992/ismodifiedaction@master"
  args = "packages/web folder/of/myBackendProject .github/main.workflow"
}

action "Is Develop Branch" {
  uses = "actions/bin/filter@master"
  args = "branch develop"
}

action "Build" {
  needs = ["Yarn install"]
  uses = "docker://node:10"
  runs = "yarn"
  args = "build"
}

action "Deploy Staging" {
  needs = ["Is backend files changed", "Is Develop Branch", "Build"]
  uses = "./.github/yarn"
  args = "deploy staging"
  secrets = [
    "FIREBASE_TOKEN",
  ]
}

```

Then when it comes release to production

```css
workflow "Deploy to Production on Release" {
  on = "release"
  resolves = ["Deploy iOS App", "Deploy Android App", "Deploy Production"]
}

action "Deploy iOS App" {
  uses = "./.github/deployMac"
  args = "ios"
  secrets = [
    "MAC_MACHINE_TOKEN",
  ]
}

action "Deploy Android App" {
  uses = "./.github/androidBuild"
  args = "ios"
  secrets = [
    "GOOGLE_PLAY_TOKEN",
  ]
}

action "Deploy Production" {
  needs = ["Build"]
  uses = "./.github/yarn"
  args = "deploy production"
  secrets = [
    "FIREBASE_TOKEN",
  ]
}
```

All we need to do now is draft a release on GitHub, and everything will be deployed automatically.

### This blog

This blog is also powered by GitHub Action:

1. It will deploy to https://reily.app when push or merge PRs to master. Which is hosted on Firebase Hosting
1. It will deploy to https://reily_<branch_name>.surge.sh when push to none master PRs.
1. It will add a [comment](https://github.com/zhigang1992/reily.app/pull/3#issuecomment-470367848) to PRs when created.

You can find the source code [here](https://github.com/zhigang1992/reily.app/blob/master/.github/main.workflow)

## Comparing over traditional CI infrastructure.

GitHub actions has all the quality of a good CI server:

- Configure as code in version control
- Flexible and scalable container execution

Comparing to other CI solution like Jenkins, Circle, TravisCI, GitHub actions is also much easier to integrate with GitHub.

For one, you no longer need to setup Deploy key or ssh key just to checkout the code. 
It's also much easier to report back to GitHub with in action with `GITHUB_TOKEN`.

Secondly, configure as code.

You can `use` in a step:

- any docker container
- subfolder in current repo
- any public repo on GitHub

And with the community grow, there are more and more repo on GitHub that you can plug and play.

If you build a useful custom action, simply by extracting into a repo. Other people would be able to use it in their code.


### Capabilities

### Lack of Capabilities (Mac build instance)

Workarounds:

## Useful Actions

### Debug
actions:bin/debug

### Local Debug

acl:

### ...

### Error reporting

Report to Slack / Telegram on error

## Issues

### Cancel treated as error
### Cancel will cancel whole workflow.
### Can not re-run actions

